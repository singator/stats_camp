---
title: "hrv2"
author: "Vik Gopal"
date: "14 May 2019"
output: html_document
---

```{r load_libraries, message=FALSE, warning=FALSE}
library(RHRV)
library(tidyverse)

create_nihr <- function(fname) {
  obj <- CreateHRVData()
  vec1 <- read.table(fname)[,1]
  vec1 <- vec1 - vec1[1]
  obj <- LoadBeatVector(obj, vec1, scale = 0.001)
  obj <- BuildNIHR(obj)
  obj <- SetVerbose(obj, TRUE)
  obj
}
```

## Template plots and analysis

* Read in baseline, exercise and music hrs
* Overlay them (requires zero-ing of time)
    * Display standard errors, outliers, summaries, smooths
* Function to detect return to baseline
* Can we use Poincare plot to detect episodes? Can we use the point at which
correlation drops back to zero?
* Work on storing hr objects in a tibble or data frame.

## Read in files

```{r}
# Load baseline
base_hr <- create_nihr("baseline.txt")
base2 <- FilterNIHR(base_hr)
PlotNIHR(base_hr)
#hr = FilterNIHR(hr)

ex_hr <- create_nihr("after_exercise.txt")
PlotNIHR(ex_hr)

music_hr <-  create_nihr("during_music.txt")
music2 <- FilterNIHR(music_hr)
PlotNIHR(music2)
```

## Overlay Two HR series

```{r}
ex2 <- FilterNIHR(ex_hr)
PlotNIHR(ex2, col="red")
lines(base2$Beat$Time, base2$Beat$niHR, col="gray")
```

## Display Baseline with Mean and SD
```{r}
ex2 <- CreateTimeAnalysis(ex2, size=15)
```

